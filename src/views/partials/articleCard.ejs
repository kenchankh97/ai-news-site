<%
  const title = (lang === 'zh-TW' && article.title_zh_tw) ? article.title_zh_tw
              : (lang === 'zh-CN' && article.title_zh_cn) ? article.title_zh_cn
              : article.title_en;

  const summary = (lang === 'zh-TW' && article.summary_zh_tw) ? article.summary_zh_tw
                : (lang === 'zh-CN' && article.summary_zh_cn) ? article.summary_zh_cn
                : (article.summary_en || '');

  const colorMap = {
    'ai-business':   { badge: 'badge-business',   label: 'AI Business',    labelZhTw: 'AI 商業',  labelZhCn: 'AI 商业'  },
    'ai-technology': { badge: 'badge-technology', label: 'AI Technology',  labelZhTw: 'AI 科技',  labelZhCn: 'AI 科技'  },
    'ai-ethics':     { badge: 'badge-ethics',     label: 'AI Ethics',      labelZhTw: 'AI 倫理',  labelZhCn: 'AI 伦理'  },
    'ai-research':   { badge: 'badge-research',   label: 'AI Research',    labelZhTw: 'AI 研究',  labelZhCn: 'AI 研究'  }
  };
  const meta = colorMap[article.category] || { badge: 'badge-technology', label: article.category };
  const badgeLabel = lang === 'zh-TW' ? (meta.labelZhTw || meta.label)
                   : lang === 'zh-CN' ? (meta.labelZhCn || meta.label)
                   : meta.label;

  const pubDate = article.published_at || article.fetched_at;
  const dateStr = pubDate ? new Date(pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '';
  const articleUrl = article.gnews_url || article.source_url || '#';
%>

<article class="card-hover flex flex-col group">
  <% if (article.image_url) { %>
  <div class="relative -mx-6 -mt-6 mb-4 overflow-hidden rounded-t-xl aspect-video bg-gray-800">
    <img
      src="<%= article.image_url %>"
      alt="<%= title %>"
      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
      loading="lazy"
      decoding="async"
      onerror="this.closest('div').style.display='none'"
    />
  </div>
  <% } %>

  <div class="flex flex-col flex-1 gap-3">
    <!-- Category badge + Date -->
    <div class="flex items-center justify-between gap-2">
      <span class="badge <%= meta.badge %>"><%= badgeLabel %></span>
      <% if (dateStr) { %>
      <time class="text-xs text-gray-600 flex-shrink-0" datetime="<%= pubDate %>"><%= dateStr %></time>
      <% } %>
    </div>

    <!-- Title -->
    <h2 class="font-semibold text-gray-100 leading-snug line-clamp-2 group-hover:text-indigo-300 transition-colors text-[15px]">
      <%= title %>
    </h2>

    <!-- Summary -->
    <% if (summary) { %>
    <p class="text-sm text-gray-400 line-clamp-3 leading-relaxed flex-1"><%= summary %></p>
    <% } else { %>
    <div class="flex-1"></div>
    <% } %>

    <!-- Source + Read More -->
    <div class="flex items-center justify-between pt-1 mt-auto border-t border-gray-800">
      <span class="text-xs text-gray-600 truncate max-w-[60%]"><%= article.source_name || '' %></span>
      <a
        href="<%= articleUrl %>"
        target="_blank"
        rel="noopener noreferrer"
        class="text-xs text-indigo-400 hover:text-indigo-300 transition-colors flex items-center gap-1 flex-shrink-0 ml-2"
      >
        <%= lang === 'zh-TW' ? '閱讀全文' : lang === 'zh-CN' ? '阅读全文' : 'Read More' %>
        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
        </svg>
      </a>
    </div>
  </div>
</article>
